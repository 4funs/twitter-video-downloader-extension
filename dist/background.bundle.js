(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var e=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r,i;return n=e,r=[{key:"fetch",value:function(t){function e(e,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return fetch("".concat(t,"/i/api/2/timeline/conversation/").concat(e,".json?tweet_mode=extended"),{credentials:"include",headers:new Headers(n)}).then((function(t){return t.json()})).then((function(t){var n=t.globalObjects.tweets,r=n[e];return!r.extended_entities&&r.quoted_status_id_str&&(r=n[r.quoted_status_id_str]),{url:r.extended_entities.media[0].video_info.variants.filter((function(t){return"video/mp4"===t.content_type})).sort((function(t,e){return e.bitrate-t.bitrate}))[0].url,name:r.full_text.substring(0,50)}}))}))}],r&&t(n.prototype,r),i&&t(n,i),e}(),n="https://twitter.com",r={};chrome.webRequest.onSendHeaders.addListener((function(t){t.requestHeaders.filter((function(t){return["x-guest-token","x-csrf-token","authorization"].indexOf(t.name)>-1})).forEach((function(e){n=t.initiator,r[e.name]=e.value}))}),{urls:["*://*.twitter.com/i/api/*"],types:["xmlhttprequest"]},["requestHeaders"]);var i=new e;chrome.runtime.onMessage.addListener((function(t,e,o){if("getVideoUrl"===t.action)return i.fetch(n,t.id,r).then((function(t){o({status:!0,url:t.url,name:t.name})})).catch((function(){o({status:!1})})),!0})),chrome.runtime.onInstalled.addListener((function(){chrome.tabs.query({url:"*://twitter.com/*",currentWindow:!0},(function(t){t.forEach((function(t){chrome.tabs.reload(t.id)}))}))}))})();