(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var e=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.baseURL="https://twitter.com/i/api/2/timeline/conversation/"}var n,r,i;return n=e,r=[{key:"fetch",value:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch("".concat(this.baseURL).concat(t,".json?tweet_mode=extended"),{credentials:"include",headers:new Headers(e)}).then((function(t){return t.json()})).then((function(e){var n=e.globalObjects.tweets,r=n[t];return!r.extended_entities&&r.quoted_status_id_str&&(r=n[r.quoted_status_id_str]),{url:r.extended_entities.media[0].video_info.variants.filter((function(t){return"video/mp4"===t.content_type})).sort((function(t,e){return e.bitrate-t.bitrate}))[0].url,name:r.full_text.substring(0,50)}}))}))}],r&&t(n.prototype,r),i&&t(n,i),e}(),n={};chrome.webRequest.onSendHeaders.addListener((function(t){t.requestHeaders.filter((function(t){return["x-guest-token","x-csrf-token","authorization"].indexOf(t.name)>-1})).forEach((function(t){n[t.name]=t.value}))}),{urls:["*://twitter.com/i/api/*"],types:["xmlhttprequest"]},["requestHeaders"]);var r=new e;chrome.runtime.onMessage.addListener((function(t,e,i){if("getVideoUrl"===t.action)return r.fetch(t.id,n).then((function(t){i({status:!0,url:t.url,name:t.name})})).catch((function(){i({status:!1})})),!0})),chrome.runtime.onInstalled.addListener((function(){chrome.tabs.query({url:"*://twitter.com/*",currentWindow:!0},(function(t){t.forEach((function(t){chrome.tabs.reload(t.id)}))}))}))})();